<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Epic Casino Slot Machine - Final Combined</title>
  <style>
    /****************************************************
     *            FULLSCREEN LAYOUT & BASE              *
     ****************************************************/
    * {
      margin: 0; 
      padding: 0; 
      box-sizing: border-box;
      font-family: 'Trebuchet MS', sans-serif;
    }
    html, body {
      width: 100%; 
      height: 100%;
      overflow: hidden; /* Hide scrollbars */
      background: linear-gradient(135deg, #1f1c2c, #928dab);
    }
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      color: #fff;
    }
    .slot-machine-container {
      position: relative;
      width: 100vw;
      height: 100vh;
      background: radial-gradient(ellipse at center, rgba(0,0,0,0.7), rgba(0,0,0,1));
      overflow: hidden;
    }

    /****************************************************
     *         HEADER / TOP-CENTER & MESSAGES           *
     ****************************************************/
    .top-header {
      position: absolute;
      top: 20px; 
      left: 50%;
      transform: translateX(-50%);
      text-align: center;
    }
    .top-header h1 {
      font-size: 4rem;
      text-transform: uppercase;
      letter-spacing: 3px;
      color: #ffcb05;
      text-shadow: 
        0 0 15px rgba(255, 203, 5, 0.7),
        0 0 30px rgba(255, 203, 5, 0.5);
    }
    .message {
      margin-top: 10px;
      font-size: 1.6rem;
      min-height: 2em;
      text-shadow: 0 0 10px #fff;
    }
    .balance-container {
      margin-top: 8px;
      font-size: 1.6rem;
      color: #0ef;
      text-shadow: 0 0 8px #0ef;
    }
    .bonus-message {
      margin-top: 5px;
      font-style: italic;
      color: #fb0;
      text-shadow: 0 0 8px #fb0;
      font-size: 1.4rem;
      min-height: 1.2em;
    }

    /****************************************************
     *               CHEAT MENU (TOP-RIGHT)             *
     ****************************************************/
    .cheats-menu {
      position: absolute;
      top: 20px; 
      right: 20px;
      background: rgba(0,0,0,0.65);
      padding: 15px;
      border: 2px solid #444;
      border-radius: 8px;
      width: 220px;
    }
    .cheats-menu h2 {
      margin-bottom: 6px;
      font-size: 1.1rem;
      text-transform: uppercase;
      text-align: center;
    }
    .cheats-menu label {
      display: block;
      margin-bottom: 6px;
      cursor: pointer;
      font-size: 0.9rem;
      color: #ccc;
    }

    /****************************************************
     *       REELS CONTAINER (CENTERED, MUCH LARGER)    *
     ****************************************************/
    .reels-container {
      position: absolute;
      top: 50%; 
      left: 50%;
      transform: translate(-50%, -50%);
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .reels {
      display: flex;
      gap: 25px;
      position: relative;
      margin-bottom: 40px;
    }
    .reel {
      width: 150px;   /* Each symbol is 150px tall, reel is 3 rows => 450px */
      height: 450px;  
      overflow: hidden;
      background: #111;
      border: 5px solid #444;
      border-radius: 10px;
      box-shadow: inset 0 0 10px rgba(255,255,255,0.2);
      position: relative;
    }
    .reel-inner {
      position: absolute;
      width: 100%;
      transform: translateY(0);
    }
    .reel-symbol {
      width: 150px;
      height: 150px;
      display: flex; 
      align-items: center; 
      justify-content: center;
      font-size: 3rem;
    }

    /* PAY-LINE */
    .win-line {
      display: none;
      position: absolute;
      top: 150px;  /* middle row => row #2 */
      left: 0;
      width: calc(150px*4 + 25px*3); /* 4 reels + 3 gaps => 675 total width */
      height: 150px;
      border: 4px solid #f00;
      box-sizing: border-box;
      pointer-events: none;
      animation: flickerLine 1s infinite alternate;
    }
    @keyframes flickerLine {
      0%   { box-shadow: 0 0 10px #f00; }
      100% { box-shadow: 0 0 25px #f00; }
    }

    /****************************************************
     *           DENOMINATION (BOTTOM-LEFT)             *
     ****************************************************/
    .denomination-container {
      position: absolute;
      bottom: 50px; 
      left: 50px;
      background: rgba(0,0,0,0.6);
      padding: 15px;
      border: 2px solid #666;
      border-radius: 8px;
    }
    .denomination-container h2 {
      font-size: 1.1rem;
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #fff;
    }
    .bet-options {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .bet-options label {
      font-size: 1rem;
      cursor: pointer;
      position: relative;
      display: inline-block;
      padding: 8px 14px;
      border: 2px solid #fff;
      border-radius: 4px;
      background: linear-gradient(145deg, #222, #555);
      color: #ff0;
      box-shadow: 0 3px 6px rgba(0,0,0,0.5);
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .bet-options label:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 12px rgba(0,0,0,0.7);
    }
    .bet-options input[type="radio"] {
      display: none;
    }
    .bet-options input[type="radio"]:checked + span {
      box-shadow: 0 0 10px #ff0, 0 0 20px #ff0;
    }

    /****************************************************
     *           SPIN BUTTON (BOTTOM-CENTER)            *
     ****************************************************/
    .spin-button {
      position: absolute;
      bottom: 50px; 
      left: 50%;
      transform: translateX(-50%);
      background: radial-gradient(circle, #f00 0%, #900 70%);
      border: 3px solid #fff;
      font-size: 2.5rem;
      font-weight: bold;
      color: #ff0;
      padding: 25px 50px;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 0 20px rgba(255, 0, 0, 0.7),
                  inset 0 0 15px rgba(255, 255, 0, 0.5);
      animation: spinPulse 1.5s infinite ease-in-out;
      z-index: 10;
    }
    .spin-button:hover {
      background: radial-gradient(circle, #f66 0%, #900 70%);
      transform: translateX(-50%) scale(1.05);
      box-shadow: 0 0 30px rgba(255,0,0,1),
                  inset 0 0 15px rgba(255,255,0,0.7);
    }
    .spin-button:active {
      transform: translateX(-50%) scale(0.95);
    }
    @keyframes spinPulse {
      0%   { box-shadow: 0 0 20px rgba(255, 0, 0, 0.7); }
      50%  { box-shadow: 0 0 30px rgba(255, 0, 0, 1);   }
      100% { box-shadow: 0 0 20px rgba(255, 0, 0, 0.7); }
    }

    /****************************************************
     *          JACKPOT OVERLAY (EGGPLANT x4)           *
     ****************************************************/
    .jackpot-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100vw; 
      height: 100vh;
      background: rgba(0,0,0,0.7);
      justify-content: center;
      align-items: center;
      z-index: 9999; /* on top of everything */
    }
    .jackpot-content {
      font-size: 6rem;
      color: #ff0;
      text-shadow: 
        0 0 10px #ff0,
        0 0 20px #ff0,
        0 0 30px #f00,
        0 0 40px #f00,
        0 0 50px #f00;
      animation: jackpotFlash 2s infinite;
    }
    @keyframes jackpotFlash {
      0% { color: #ff0; text-shadow: 0 0 20px #ff0; }
      50%{ color: #f00; text-shadow: 0 0 30px #f00; }
      100%{ color: #ff0; text-shadow: 0 0 20px #ff0; }
    }

    /****************************************************
     *          MINIGAME OVERLAY & STYLES               *
     ****************************************************/
    .overlay {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100vw; 
      height: 100vh;
      background: rgba(0,0,0,0.7);
      justify-content: center;
      align-items: center;
      z-index: 999;
      animation: fadeIn 0.5s forwards;
    }
    @keyframes fadeIn {
      0%   {opacity: 0;}
      100% {opacity: 1;}
    }
    .overlay-content {
      background: #333;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      width: 320px;
      animation: scaleUp 0.5s forwards;
    }
    @keyframes scaleUp {
      0%   {transform: scale(0.7);}
      100% {transform: scale(1);}
    }
    .overlay h2 {
      margin-bottom: 10px;
    }
    .overlay .message {
      margin: 8px 0;
    }
    .overlay button {
      background: #34c759;
      border: none;
      color: #fff;
      padding: 10px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      margin-top: 8px;
      margin-bottom: 8px;
      transition: transform 0.2s, background 0.2s;
      font-size: 1rem;
    }
    .overlay button:hover {
      background: #2fa84f;
      transform: scale(1.05);
    }
    .overlay button:active {
      transform: scale(0.95);
    }

    /* Minigame tile styles */
    .mini-tile {
      width: 60px;
      height: 60px;
      background: #555;
      border-radius: 5px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 1.4rem;
      color: #fff;
      cursor: pointer;
      margin: 5px;
      transition: transform 0.2s, background 0.2s;
    }
    .mini-tile:hover {
      transform: scale(1.1);
      background: #777;
    }
    .game-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin: 10px 0;
    }

  </style>
</head>
<body>
  <div class="slot-machine-container">

    <!-- CHEAT MENU (top-right) -->
    <div class="cheats-menu">
      <h2>Cheats</h2>
      <label><input type="checkbox" id="cheatAlwaysWinMoney" /> Always Win Money</label>
      <label><input type="checkbox" id="cheatAlwaysJackpot" /> Always Win Jackpot</label>
      <label><input type="checkbox" id="cheatUnlimitedFunds" /> Unlimited Funds</label>
      <label><input type="checkbox" id="cheatAlwaysMinigame" /> Always Minigame</label>
    </div>

    <!-- HEADER (top-center) -->
    <div class="top-header">
      <h1>EPIC CASINO SLOTS</h1>
      <div class="message" id="message"></div>
      <div class="balance-container">
        Balance: $<span id="balance">20.00</span>
      </div>
      <div class="bonus-message" id="bonusMessage"></div>
    </div>

    <!-- REELS (center) -->
    <div class="reels-container">
      <div class="reels">
        <div class="reel"><div class="reel-inner" id="reel1-inner"></div></div>
        <div class="reel"><div class="reel-inner" id="reel2-inner"></div></div>
        <div class="reel"><div class="reel-inner" id="reel3-inner"></div></div>
        <div class="reel"><div class="reel-inner" id="reel4-inner"></div></div>
        <div class="win-line" id="winLine"></div>
      </div>
    </div>

    <!-- DENOMINATION (bottom-left) -->
    <div class="denomination-container">
      <h2>Denomination</h2>
      <div class="bet-options">
        <label>
          <input type="radio" name="bet" value="50">
          <span>$0.50</span>
        </label>
        <label>
          <input type="radio" name="bet" value="100">
          <span>$1.00</span>
        </label>
        <label>
          <input type="radio" name="bet" value="250">
          <span>$2.50</span>
        </label>
        <label>
          <input type="radio" name="bet" value="500">
          <span>$5.00</span>
        </label>
        <label>
          <input type="radio" name="bet" value="750">
          <span>$7.50</span>
        </label>
        <label>
          <input type="radio" name="bet" value="1000">
          <span>$10.00</span>
        </label>
      </div>
    </div>

    <!-- SPIN BUTTON (bottom-center) -->
    <button class="spin-button" id="spinBtn">SPIN</button>

    <!-- JACKPOT OVERLAY -->
    <div class="jackpot-overlay" id="jackpotOverlay">
      <div class="jackpot-content" id="jackpotContent">JACKPOT!!!</div>
    </div>

    <!-- AUDIO ELEMENTS -->
    <audio id="bgMusic"   src="assets/background.mp3" loop></audio>
    <audio id="spinSound" src="assets/roll.mp3"></audio>
    <audio id="winSound"  src="assets/win.mp3"></audio>

    <!-- MINIGAME OVERLAY -->
    <div class="overlay" id="minigameOverlay">
      <div class="overlay-content" id="overlayContent">
        <h2 id="miniTitle">???</h2>
        <div class="game-container" id="miniGameContainer"></div>
        <div class="message" id="miniGameMessage"></div>
        <button id="minigameQuitBtn">Quit</button>
      </div>
    </div>

    <script>
      /********************************************
       *        SLOT MACHINE CORE LOGIC           *
       ********************************************/
      const iconSet = [
        "ðŸ†","ðŸ’","ðŸ‹","ðŸ’Ž","7","ðŸ‰","â­","ðŸ‡","ðŸŒ½","ðŸ…",
        "ðŸ‘","ðŸ¥­","ðŸ","ðŸˆ","ðŸŽ","ðŸ","ðŸ","ðŸŠ","ðŸŒ","ðŸ”",
        "ðŸ•","ðŸ¤","ðŸš","ðŸ¿","ðŸ­","ðŸ¬","ðŸ©","ðŸª","ðŸŽ‚","ðŸ°",
        "ðŸ¥©","ðŸ—","ðŸŒ®","ðŸŒ­","ðŸ£","ðŸ¥‘","ðŸ¥¦","ðŸ¥•","ðŸ¥","ðŸ„"
      ];
      const symbolsCount = iconSet.length; // 40
      const symbolSize   = 150;           // each symbol = 150px
      let balanceCents   = 2000;          // $20.00
      let freeSpins      = 0;
      let isSpinning     = false;

      // Multipliers (for more realistic big payouts)
      // Example: if bet=1000 ($10) and 4 eggplants => 1000Ã— => $10,000
      const MULTIPLIERS = {
        jackpotEggplant: 1000, // 4 eggplants
        fourOfKind: 500,
        threeOfKind: 100,
        twoOfKind: 25
      };

      // Minigame chance
      let MINIGAME_CHANCE = 0.05;

      // DOM Elements
      const balanceEl    = document.getElementById("balance");
      const bonusMessage = document.getElementById("bonusMessage");
      const messageEl    = document.getElementById("message");
      const spinBtn      = document.getElementById("spinBtn");
      const winLine      = document.getElementById("winLine");

      const reel1Inner = document.getElementById("reel1-inner");
      const reel2Inner = document.getElementById("reel2-inner");
      const reel3Inner = document.getElementById("reel3-inner");
      const reel4Inner = document.getElementById("reel4-inner");

      // Cheats
      const cheatAlwaysWinMoney = document.getElementById("cheatAlwaysWinMoney");
      const cheatAlwaysJackpot  = document.getElementById("cheatAlwaysJackpot");
      const cheatUnlimitedFunds = document.getElementById("cheatUnlimitedFunds");
      const cheatAlwaysMinigame = document.getElementById("cheatAlwaysMinigame");

      // Audio
      const bgMusic   = document.getElementById("bgMusic");
      const spinSound = document.getElementById("spinSound");
      const winSound  = document.getElementById("winSound");

      // JACKPOT overlay
      const jackpotOverlay = document.getElementById("jackpotOverlay");

      // Build repeated reels (40 Ã— 3 = 120)
      function initReels() {
        let repeated = [];
        for (let i=0; i<3; i++){
          for (let j=0; j<symbolsCount; j++){
            repeated.push(iconSet[j]);
          }
        }
        const reelHTML = repeated.map(sym => `<div class="reel-symbol">${sym}</div>`).join("");
        reel1Inner.innerHTML = reelHTML;
        reel2Inner.innerHTML = reelHTML;
        reel3Inner.innerHTML = reelHTML;
        reel4Inner.innerHTML = reelHTML;
      }
      initReels();

      function updateBalanceDisplay(){
        balanceEl.textContent = (balanceCents / 100).toFixed(2);
      }
      updateBalanceDisplay();

      function getSelectedBet(){
        const betRadios = document.getElementsByName("bet");
        let betValue=0;
        betRadios.forEach(r=>{
          if(r.checked) betValue = parseInt(r.value,10);
        });
        return betValue;
      }

      function randInt(n){ return Math.floor(Math.random()*n); }

      // Try to start background music once user interacts
      function startBgMusic(){
        bgMusic.play().catch(err=>{
          console.warn("Background music blocked:", err);
        });
      }

      // Spin reel so finalIndex is the MIDDLE row symbol.
      // We'll do 2 full loops => 2*(40*symbolSize)=2*6000=12000
      // plus a random offset + topIndex
      function spinOneReel(reelInner, finalIndex, durationSec){
        reelInner.style.transition="none";
        reelInner.style.transform="translateY(0)";
        void reelInner.offsetWidth; // reflow

        const topIndex = (finalIndex - 1 + symbolsCount) % symbolsCount;
        const randomOffset = randInt(5)*symbolSize; // up to 4 symbols offset
        const distance = (2*symbolsCount*symbolSize) + randomOffset + topIndex*symbolSize;
        reelInner.style.transition = `transform ${durationSec}s linear`;
        reelInner.style.transform = `translateY(-${distance}px)`;
      }

      // Evaluate the MIDDLE row
      function evaluateMiddleRow(finalIndices, betCents){
        const midSymbols = finalIndices.map(idx => iconSet[idx]);
        const firstSym   = midSymbols[0];
        let matches=1;
        for(let i=1; i<4; i++){
          if(midSymbols[i]===firstSym) matches++;
        }
        let winnings=0;
        if(firstSym==="ðŸ†" && matches===4){
          // 4 eggplants => 1000Ã—
          winnings = betCents * MULTIPLIERS.jackpotEggplant;
        } else if(matches===4){
          winnings = betCents * MULTIPLIERS.fourOfKind;
        } else if(matches===3){
          winnings = betCents * MULTIPLIERS.threeOfKind;
        } else if(matches===2){
          winnings = betCents * MULTIPLIERS.twoOfKind;
        }
        return {winnings, matches, midSymbols};
      }

      function handleWinLine(matches){
        winLine.style.display = (matches>=2)?"block":"none";
      }

      // Show/hide JACKPOT overlay
      function showJackpotOverlay(show){
        jackpotOverlay.style.display = show?"flex":"none";
      }

      function spinAllReels(){
        if(isSpinning) return;
        startBgMusic(); // attempt to start music

        let bet = getSelectedBet();
        if(!bet){
          messageEl.textContent="Please select a bet first!";
          return;
        }
        const isFreeSpin=(freeSpins>0);

        if(!isFreeSpin && !cheatUnlimitedFunds.checked){
          if(balanceCents<bet){
            messageEl.textContent="Not enough balance!";
            return;
          }
        }

        // Deduct bet if not free spin & not unlimited
        if(!isFreeSpin && !cheatUnlimitedFunds.checked){
          balanceCents-=bet;
          updateBalanceDisplay();
        }

        messageEl.textContent="";
        bonusMessage.textContent="";
        handleWinLine(0);

        isSpinning=true;

        // spin sound
        spinSound.currentTime=0;
        spinSound.play().catch(err=> console.log("spinSound blocked:", err));

        // Decide final indices
        const finalIndices=[0,0,0,0];
        if(cheatAlwaysJackpot.checked){
          // 4 eggplants => ðŸ† is iconSet[0]
          finalIndices[0]=0; finalIndices[1]=0; finalIndices[2]=0; finalIndices[3]=0;
        } else if(cheatAlwaysWinMoney.checked){
          // Force >=2-of-a-kind
          const r=randInt(symbolsCount);
          finalIndices[0]=r; 
          finalIndices[1]=r;
          finalIndices[2]=randInt(symbolsCount);
          finalIndices[3]=randInt(symbolsCount);
        } else {
          for(let i=0;i<4;i++){
            finalIndices[i]=randInt(symbolsCount);
          }
        }

        // spin reels left->right: 1s,2s,3s,4s
        spinOneReel(reel1Inner, finalIndices[0], 1);
        spinOneReel(reel2Inner, finalIndices[1], 2);
        spinOneReel(reel3Inner, finalIndices[2], 3);
        spinOneReel(reel4Inner, finalIndices[3], 4);

        setTimeout(()=>{
          const {winnings,matches,midSymbols}=evaluateMiddleRow(finalIndices, bet);
          balanceCents += winnings;
          updateBalanceDisplay();

          if(winnings>0){
            // win sound
            winSound.currentTime=0;
            winSound.play().catch(err=>console.log("winSound blocked:",err));

            let msg="";
            if(matches===2){
              msg="2-of-a-kind!";
            } else if(matches===3){
              msg="3-of-a-kind!";
            } else if(matches===4&&midSymbols[0]==="ðŸ†"){
              msg="EGGPLANT JACKPOT!";
              // show overlay for 3s
              showJackpotOverlay(true);
              setTimeout(()=>showJackpotOverlay(false),3000);
            } else if(matches===4){
              msg="4-of-a-kind!";
            }
            messageEl.textContent=`${msg} Middle row: ${midSymbols.join(" ")}. You won $${(winnings/100).toFixed(2)}!`;
          } else {
            messageEl.textContent=`No match. Middle row: ${midSymbols.join(" ")}. Better luck next time!`;
          }
          handleWinLine(matches);

          // free spin if 3-of-a-kind or better
          if(matches>=3 && winnings>0){
            freeSpins++;
            bonusMessage.textContent=`You earned +1 FREE SPIN! (Now ${freeSpins})`;
          } else if(isFreeSpin){
            freeSpins--;
            bonusMessage.textContent=`Used 1 FREE SPIN. ${freeSpins} left.`;
          }

          // Possibly minigame
          let chance=MINIGAME_CHANCE;
          if(cheatAlwaysMinigame.checked) chance=1;
          if(Math.random()<chance){
            showRandomMinigame(bet);
          }

          isSpinning=false;
        },4000);
      }
      spinBtn.addEventListener("click", spinAllReels);

      /********************************************
       *        JACKPOT & MINIGAME FEATURES       *
       ********************************************/
      // JACKPOT overlay is handled above

      // MINIGAME overlay
      const minigameOverlay   = document.getElementById("minigameOverlay");
      const miniTitle         = document.getElementById("miniTitle");
      const miniGameContainer = document.getElementById("miniGameContainer");
      const miniGameMessage   = document.getElementById("miniGameMessage");
      const minigameQuitBtn   = document.getElementById("minigameQuitBtn");

      minigameQuitBtn.onclick=()=>closeMinigameOverlay();

      function openMinigameOverlay(title){
        miniTitle.textContent=title;
        miniGameMessage.textContent="";
        miniGameContainer.innerHTML="";
        minigameOverlay.style.display="flex";
      }
      function closeMinigameOverlay(){
        minigameOverlay.style.display="none";
      }

      // We have 3 new minigames:
      //   1) One-Row Shooter
      //   2) Memory Flip
      //   3) Coin Flip
      function showRandomMinigame(bet){
        const pick=randInt(3);
        if(pick===0) showOneRowShooter(bet);
        else if(pick===1) showMemoryFlip(bet);
        else showCoinFlip(bet);
      }

      /********************************************
       * MINIGAME #1: One-Row Shooter
       ********************************************/
      function showOneRowShooter(bet){
        openMinigameOverlay("One-Row Shooter");
        const rowCount=7;
        let enemies=new Array(rowCount).fill(false);
        // place 3 random enemies
        for(let i=0; i<3; i++){
          const pos=randInt(rowCount);
          enemies[pos]=true;
        }
        enemies.forEach((isEnemy,idx)=>{
          const div=document.createElement("div");
          div.className="mini-tile";
          div.textContent=isEnemy?"?":" ";
          div.onclick=()=>{
            if(isEnemy){
              div.textContent="X";
              div.style.background="#f00";
              enemies[idx]=false;
              checkShooterWin();
            } else {
              div.textContent="O";
              div.style.background="#333";
            }
            div.onclick=null;
          };
          miniGameContainer.appendChild(div);
        });
        function checkShooterWin(){
          if(!enemies.some(e=>e)){
            // all enemies defeated => 1.5Ã— bet
            const bonus=Math.floor(bet*1.5);
            balanceCents+=bonus;
            updateBalanceDisplay();
            miniGameMessage.textContent=`All enemies down! +$${(bonus/100).toFixed(2)}.`;
            setTimeout(()=>closeMinigameOverlay(),2000);
          }
        }
      }

      /********************************************
       * MINIGAME #2: Memory Flip
       ********************************************/
      function showMemoryFlip(bet){
        openMinigameOverlay("Memory Flip");
        // 6 tiles total => 3 pairs
        const pairs=["A","B","C"];
        const memoryArr=[...pairs,...pairs];
        // shuffle
        for(let i=memoryArr.length-1; i>0; i--){
          const j=randInt(i+1);
          [memoryArr[i],memoryArr[j]]=[memoryArr[j],memoryArr[i]];
        }
        let flippedIndices=[];
        let matchedCount=0;

        memoryArr.forEach((val,idx)=>{
          const tile=document.createElement("div");
          tile.className="mini-tile";
          tile.textContent="?";
          tile.onclick=()=>flipCard(idx,tile);
          miniGameContainer.appendChild(tile);
        });
        function flipCard(i,tile){
          if(tile.dataset.flipped==="true") return;
          tile.textContent=memoryArr[i];
          tile.dataset.flipped="true";
          flippedIndices.push(i);

          if(flippedIndices.length===2){
            const i1=flippedIndices[0], i2=flippedIndices[1];
            const tile1=miniGameContainer.children[i1];
            const tile2=miniGameContainer.children[i2];
            if(memoryArr[i1]===memoryArr[i2]){
              tile1.style.background="#4f4";
              tile2.style.background="#4f4";
              matchedCount++;
            } else {
              setTimeout(()=>{
                tile1.textContent="?";
                tile2.textContent="?";
                tile1.dataset.flipped="false";
                tile2.dataset.flipped="false";
              },1000);
            }
            flippedIndices=[];
          }
          if(matchedCount===3){
            // matched all => 2Ã— bet
            const bonus=bet*2;
            balanceCents+=bonus;
            updateBalanceDisplay();
            miniGameMessage.textContent=`All matched! +$${(bonus/100).toFixed(2)}.`;
            setTimeout(()=>closeMinigameOverlay(),2000);
          }
        }
      }

      /********************************************
       * MINIGAME #3: Coin Flip
       ********************************************/
      function showCoinFlip(bet){
        openMinigameOverlay("Coin Flip");
        const container=document.createElement("div");
        container.style.display="flex";
        container.style.gap="10px";
        container.style.justifyContent="center";

        const headsBtn=document.createElement("div");
        headsBtn.className="mini-tile";
        headsBtn.textContent="Heads";
        headsBtn.onclick=()=>guess("Heads");

        const tailsBtn=document.createElement("div");
        tailsBtn.className="mini-tile";
        tailsBtn.textContent="Tails";
        tailsBtn.onclick=()=>guess("Tails");

        container.appendChild(headsBtn);
        container.appendChild(tailsBtn);
        miniGameContainer.appendChild(container);

        function guess(choice){
          const result=(Math.random()<0.5)?"Heads":"Tails";
          if(result===choice){
            // 2Ã— bet
            const bonus=bet*2;
            balanceCents+=bonus;
            updateBalanceDisplay();
            miniGameMessage.textContent=`Coin: ${result}! You won $${(bonus/100).toFixed(2)}.`;
          } else {
            miniGameMessage.textContent=`Coin: ${result}. No bonus.`;
          }
          setTimeout(()=>closeMinigameOverlay(),2000);
        }
      }
    </script>
  </div>
</body>
</html>
