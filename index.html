<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Epic Casino Slot Machine</title>
  <style>
    /****************************************************
     *               FULLSCREEN CASINO STYLE            *
     ****************************************************/
    * {
      margin: 0; padding: 0; box-sizing: border-box;
      font-family: 'Trebuchet MS', sans-serif;
    }
    html, body {
      width: 100%; 
      height: 100%;
      overflow: hidden; /* Hide any scrollbars */
      background: linear-gradient(135deg, #1f1c2c, #928dab);
    }
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      color: #fff;
    }
    /* Main container: full screen, relative for positioning child panels */
    .slot-machine-container {
      position: relative;
      width: 100vw;  /* full width */
      height: 100vh; /* full height */
      background: radial-gradient(ellipse at center, rgba(0,0,0,0.7), rgba(0,0,0,1));
      overflow: hidden;
    }

    /****************************************************
     *             HEADER / TITLE / MESSAGES            *
     ****************************************************/
    .top-header {
      position: absolute;
      top: 20px; left: 50%;
      transform: translateX(-50%);
      text-align: center;
    }
    .top-header h1 {
      font-size: 3rem;
      text-transform: uppercase;
      letter-spacing: 3px;
      color: #ffcb05;
      text-shadow: 0 0 15px rgba(255, 203, 5, 0.7),
                   0 0 30px rgba(255, 203, 5, 0.5);
    }
    .message {
      margin-top: 10px;
      font-size: 1.4rem;
      min-height: 2em;
      text-shadow: 0 0 10px #fff;
    }
    .balance-container {
      margin-top: 8px;
      font-size: 1.4rem;
      color: #0ef;
      text-shadow: 0 0 8px #0ef;
    }
    .bonus-message {
      margin-top: 5px;
      font-style: italic;
      color: #fb0;
      text-shadow: 0 0 8px #fb0;
      font-size: 1.2rem;
    }

    /****************************************************
     *      CHEAT MENU (TOP-RIGHT, FLOATING PANEL)      *
     ****************************************************/
    .cheats-menu {
      position: absolute;
      top: 20px; right: 20px;
      background: rgba(0, 0, 0, 0.65);
      padding: 15px;
      border: 2px solid #444;
      border-radius: 8px;
      width: 180px;
    }
    .cheats-menu h2 {
      margin-bottom: 6px;
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      text-align: center;
      color: #fff;
    }
    .cheats-menu label {
      display: block;
      margin-bottom: 4px;
      cursor: pointer;
      font-size: 0.9rem;
      color: #ccc;
    }

    /****************************************************
     *         REELS CONTAINER (CENTER SCREEN)          *
     ****************************************************/
    .reels-container {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .reels {
      display: flex;
      gap: 15px;
      position: relative;
      margin-bottom: 20px;
    }
    .reel {
      width: 100px;  /* bigger reel */
      height: 300px; /* 3 rows * 100px each */
      overflow: hidden;
      background: #111;
      border: 3px solid #444;
      border-radius: 8px;
      box-shadow: inset 0 0 10px rgba(255,255,255,0.2);
      position: relative;
    }
    .reel-inner {
      position: absolute;
      width: 100%;
      transform: translateY(0);
    }
    .reel-symbol {
      width: 100px;
      height: 100px;
      display: flex; 
      align-items: center; 
      justify-content: center;
      font-size: 2rem;
    }

    /* PAY-LINE */
    .win-line {
      display: none;
      position: absolute;
      top: 100px;  /* middle row => row #2 */
      left: 0;
      width: calc(100px*4 + 15px*3); /* 4 reels + 3 gaps = 4*100 + 3*15 = 400 + 45 = 445 */
      height: 100px; /* row height */
      border: 4px solid #f00;
      box-sizing: border-box;
      pointer-events: none;
      animation: flickerLine 1s infinite alternate;
    }

    /* Flickering line animation */
    @keyframes flickerLine {
      0% { box-shadow: 0 0 10px #f00; }
      100% { box-shadow: 0 0 25px #f00; }
    }

    /****************************************************
     *     FLASHING LIGHTS (a "light border" effect)    *
     ****************************************************/
    .reels-container::before {
      content: "";
      position: absolute;
      top: -20px;
      left: -20px;
      right: -20px;
      bottom: -20px;
      border: 5px dashed rgba(255, 255, 0, 0.5);
      border-radius: 20px;
      box-shadow: 0 0 30px rgba(255, 255, 0, 0.5),
                  inset 0 0 20px rgba(255, 255, 255, 0.2);
      animation: borderFlash 2s infinite linear;
      pointer-events: none;
      z-index: -1;
    }
    @keyframes borderFlash {
      0%   { border-color: rgba(255,255,0, 0.5); }
      25%  { border-color: rgba(255,0,0, 0.5);   }
      50%  { border-color: rgba(0,255,0, 0.5);   }
      75%  { border-color: rgba(0,0,255, 0.5);   }
      100% { border-color: rgba(255,255,0, 0.5); }
    }

    /****************************************************
     *     DENOMINATION (BOTTOM-LEFT, COOL BUTTONS)     *
     ****************************************************/
    .denomination-container {
      position: absolute;
      bottom: 40px; 
      left: 40px;
      background: rgba(0,0,0,0.6);
      padding: 10px 15px;
      border: 2px solid #666;
      border-radius: 8px;
    }
    .denomination-container h2 {
      font-size: 1rem;
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #fff;
    }
    .bet-options {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .bet-options label {
      font-size: 0.9rem;
      cursor: pointer;
      position: relative;
      display: inline-block;
      padding: 6px 12px;
      border: 2px solid #fff;
      border-radius: 4px;
      background: linear-gradient(145deg, #222, #555);
      color: #ff0;
      box-shadow: 0 2px 5px rgba(0,0,0,0.5);
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .bet-options label:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(0,0,0,0.7);
    }
    .bet-options input[type="radio"] {
      display: none;
    }
    /* highlight selected bet with a glow */
    .bet-options input[type="radio"]:checked + span {
      box-shadow: 0 0 10px #ff0, 0 0 20px #ff0;
    }

    /****************************************************
     *     SPIN BUTTON (BOTTOM-CENTER, GIANT, FLASHY)    *
     ****************************************************/
    .spin-button {
      position: absolute;
      bottom: 40px; 
      left: 50%;
      transform: translateX(-50%);
      background: radial-gradient(circle, #f00 0%, #900 70%);
      border: 3px solid #fff;
      font-size: 2rem;
      font-weight: bold;
      color: #ff0;
      padding: 20px 40px;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 0 15px rgba(255, 0, 0, 0.7),
                  inset 0 0 10px rgba(255, 255, 0, 0.5);
      animation: spinPulse 1.5s infinite ease-in-out;
      z-index: 10;
    }
    .spin-button:hover {
      background: radial-gradient(circle, #f66 0%, #900 70%);
      transform: translateX(-50%) scale(1.05);
      box-shadow: 0 0 25px rgba(255,0,0,1),
                  inset 0 0 15px rgba(255,255,0,0.7);
    }
    .spin-button:active {
      transform: translateX(-50%) scale(0.95);
    }
    @keyframes spinPulse {
      0%   { box-shadow: 0 0 15px rgba(255, 0, 0, 0.7); }
      50%  { box-shadow: 0 0 25px rgba(255, 0, 0, 1);   }
      100% { box-shadow: 0 0 15px rgba(255, 0, 0, 0.7); }
    }

    /****************************************************
     *                   OVERLAY (MINIGAMES)            *
     ****************************************************/
    .overlay {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.7);
      justify-content: center;
      align-items: center;
      z-index: 999;
      animation: fadeIn 0.5s forwards;
    }
    @keyframes fadeIn {
      0%   {opacity: 0;}
      100% {opacity: 1;}
    }
    .overlay-content {
      background: #333;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      width: 300px;
      animation: scaleUp 0.5s forwards;
    }
    @keyframes scaleUp {
      0%   {transform: scale(0.7);}
      100% {transform: scale(1);}
    }

    .overlay h2 {
      margin-bottom: 10px;
    }
    .overlay .message {
      margin: 8px 0;
    }
    .overlay button {
      background: #34c759;
      border: none;
      color: #fff;
      padding: 8px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      margin-top: 8px;
      margin-bottom: 8px;
      transition: transform 0.2s, background 0.2s;
    }
    .overlay button:hover {
      background: #2fa84f;
      transform: scale(1.05);
    }
    .overlay button:active {
      transform: scale(0.95);
    }

    /* Cards, TicTacToe, Hangman styles from previous code omitted for brevity, but retained below */
    .cards-container {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      margin: 10px 0;
    }
    .card {
      width: 60px;
      height: 60px;
      background: #555;
      border-radius: 5px;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      user-select: none;
      transition: transform 0.3s, background 0.3s;
    }
    .card:hover {
      transform: scale(1.07);
    }
    .card.flipped {
      background: #777 !important;
      color: #fff;
      font-size: 1.4rem;
      transform: scale(1) !important;
      cursor: default;
    }

    .tic-container {
      display: grid;
      grid-template-columns: repeat(3, 60px);
      grid-gap: 5px;
      margin: 15px auto;
      justify-content: center;
    }
    .tic-cell {
      width: 60px; 
      height: 60px;
      background: #555;
      border-radius: 5px;
      font-size: 2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background 0.3s, transform 0.2s;
      user-select: none;
    }
    .tic-cell:hover { transform: scale(1.05); }
    .tic-cell.X { color: #37f; }
    .tic-cell.O { color: #f55; }
    .tic-cell.disabled { 
      cursor: default; 
      background: #666; 
      transform: none !important;
    }

    .hangman-figure {
      margin-bottom: 6px;
      font-size: 0.9rem;
      color: #ccc;
      height: 60px;
    }
    .hangman-word {
      font-size: 1.8rem;
      margin-bottom: 10px;
      letter-spacing: 5px;
    }
    .alphabet {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      justify-content: center;
      max-width: 250px;
      margin: 0 auto 10px auto;
    }
    .alphabet button {
      width: 30px;
      height: 30px;
      margin: 3px;
      padding: 0;
      font-size: 1rem;
      border-radius: 3px;
      background: #555;
    }
    .alphabet button.used {
      background: #777;
      cursor: default;
    }
    .hangman-status { margin: 8px 0; }

  </style>
</head>
<body>
  <div class="slot-machine-container">
    
    <!-- CHEAT MENU: top-right -->
    <div class="cheats-menu">
      <h2>Cheats</h2>
      <label><input type="checkbox" id="cheatAlwaysWinMoney" /> Always Win Money</label>
      <label><input type="checkbox" id="cheatAlwaysJackpot" /> Always Win Jackpot</label>
      <label><input type="checkbox" id="cheatUnlimitedFunds" /> Unlimited Funds</label>
      <label><input type="checkbox" id="cheatAlwaysMinigame" /> Always Minigame</label>
    </div>

    <!-- HEADERS & MESSAGES: top-center -->
    <div class="top-header">
      <h1>EPIC CASINO SLOTS</h1>
      <div class="message" id="message"></div>
      <div class="balance-container">
        Balance: $<span id="balance">20.00</span>
      </div>
      <div class="bonus-message" id="bonusMessage"></div>
    </div>

    <!-- REELS + PAY-LINE: center -->
    <div class="reels-container">
      <div class="reels">
        <div class="reel"><div class="reel-inner" id="reel1-inner"></div></div>
        <div class="reel"><div class="reel-inner" id="reel2-inner"></div></div>
        <div class="reel"><div class="reel-inner" id="reel3-inner"></div></div>
        <div class="reel"><div class="reel-inner" id="reel4-inner"></div></div>
        <div class="win-line" id="winLine"></div>
      </div>
    </div>

    <!-- DENOMINATION: bottom-left -->
    <div class="denomination-container">
      <h2>Denomination</h2>
      <div class="bet-options">
        <label>
          <input type="radio" name="bet" value="50">
          <span>$0.50</span>
        </label>
        <label>
          <input type="radio" name="bet" value="100">
          <span>$1.00</span>
        </label>
        <label>
          <input type="radio" name="bet" value="250">
          <span>$2.50</span>
        </label>
        <label>
          <input type="radio" name="bet" value="500">
          <span>$5.00</span>
        </label>
        <label>
          <input type="radio" name="bet" value="750">
          <span>$7.50</span>
        </label>
        <label>
          <input type="radio" name="bet" value="1000">
          <span>$10.00</span>
        </label>
      </div>
    </div>

    <!-- SPIN BUTTON: bottom-center -->
    <button class="spin-button" id="spinBtn">SPIN</button>

    <!-- AUDIO ELEMENTS -->
    <audio id="bgMusic" src="assets/background.mp3" loop></audio>
    <audio id="spinSound" src="assets/roll.mp3"></audio>
    <audio id="winSound"  src="assets/win.mp3"></audio>

    <!-- MINIGAME OVERLAY -->
    <div class="overlay" id="minigameOverlay">
      <div class="overlay-content" id="overlayContent">
        <!-- MINIGAME #1: PICK 3 CARDS -->
        <div id="cardsGame">
          <h2>Pick 3 Cards</h2>
          <div class="cards-container" id="cardsContainer"></div>
          <div class="message" id="cardsMessage"></div>
          <button id="cardsQuitBtn">Quit</button>
        </div>

        <!-- MINIGAME #2: TIC-TAC-TOE -->
        <div id="ticTacToeGame">
          <h2>Tic-Tac-Toe</h2>
          <div class="tic-container" id="ticGrid"></div>
          <div class="message" id="ticMessage"></div>
          <button id="ticQuitBtn">Quit</button>
        </div>

        <!-- MINIGAME #3: HANGMAN -->
        <div id="hangmanGame">
          <h2>Hangman</h2>
          <div class="hangman-figure" id="hangmanFigure">Attempts left: 6</div>
          <div class="hangman-word"   id="hangmanWord"></div>
          <div class="alphabet"       id="hangmanAlphabet"></div>
          <div class="hangman-status" id="hangmanStatus"></div>
          <button id="hangmanQuitBtn">Quit</button>
        </div>
      </div>
    </div>

    <script>
      /********************************************
       *          SLOT MACHINE + AUDIO            *
       ********************************************/
      const iconSet = [
        "ðŸ†","ðŸ’","ðŸ‹","ðŸ’Ž","7","ðŸ‰","â­","ðŸ‡","ðŸŒ½","ðŸ…",
        "ðŸ‘","ðŸ¥­","ðŸ","ðŸˆ","ðŸŽ","ðŸ","ðŸ","ðŸŠ","ðŸŒ","ðŸ”",
        "ðŸ•","ðŸ¤","ðŸš","ðŸ¿","ðŸ­","ðŸ¬","ðŸ©","ðŸª","ðŸŽ‚","ðŸ°",
        "ðŸ¥©","ðŸ—","ðŸŒ®","ðŸŒ­","ðŸ£","ðŸ¥‘","ðŸ¥¦","ðŸ¥•","ðŸ¥","ðŸ„"
      ];
      const symbolsCount = iconSet.length; // 40
      const symbolHeight = 100; // we updated reels to 100px each row

      let balanceCents = 2000;  // $20
      let freeSpins    = 0;
      let isSpinning   = false;
      const MINIGAME_CHANCE = 0.05;

      // DOM references
      const balanceEl    = document.getElementById("balance");
      const bonusMessage = document.getElementById("bonusMessage");
      const messageEl    = document.getElementById("message");
      const spinBtn      = document.getElementById("spinBtn");
      const winLine      = document.getElementById("winLine");

      const reel1Inner = document.getElementById("reel1-inner");
      const reel2Inner = document.getElementById("reel2-inner");
      const reel3Inner = document.getElementById("reel3-inner");
      const reel4Inner = document.getElementById("reel4-inner");

      // Bets & Cheats
      const betRadios              = document.getElementsByName("bet");
      const cheatAlwaysWinMoney    = document.getElementById("cheatAlwaysWinMoney");
      const cheatAlwaysJackpot     = document.getElementById("cheatAlwaysJackpot");
      const cheatUnlimitedFunds    = document.getElementById("cheatUnlimitedFunds");
      const cheatAlwaysMinigame    = document.getElementById("cheatAlwaysMinigame");

      // AUDIO elements
      const bgMusic   = document.getElementById('bgMusic');
      const spinSound = document.getElementById('spinSound');
      const winSound  = document.getElementById('winSound');

      // Start background music if possible
      window.addEventListener('DOMContentLoaded', () => {
        bgMusic.play().catch(() => {
          console.warn("Autoplay blocked. User must interact first.");
        });
      });

      /********************************************
       *       BUILD THE REELS (40Ã—3 = 120)       *
       ********************************************/
      function initReels() {
        let repeated = [];
        for (let i=0; i<3; i++) {
          for (let j=0; j<symbolsCount; j++) {
            repeated.push(iconSet[j]);
          }
        }
        const reelHTML = repeated.map(icon => `<div class="reel-symbol">${icon}</div>`).join("");
        reel1Inner.innerHTML = reelHTML;
        reel2Inner.innerHTML = reelHTML;
        reel3Inner.innerHTML = reelHTML;
        reel4Inner.innerHTML = reelHTML;
      }
      initReels();

      function updateBalanceDisplay() {
        balanceEl.textContent = (balanceCents / 100).toFixed(2);
      }
      updateBalanceDisplay();

      function getSelectedBet() {
        let betValue = 0;
        betRadios.forEach(r => {
          if (r.checked) betValue = parseInt(r.value, 10);
        });
        return betValue;
      }

      function randInt(n) {
        return Math.floor(Math.random() * n);
      }

      // Spin one reel so finalIndex is the middle row => top row is finalIndex-1
      function spinOneReel(reelInner, finalIndex, durationSec) {
        reelInner.style.transition = "none";
        reelInner.style.transform  = "translateY(0)";
        void reelInner.offsetWidth; // reflow

        const topIndex = (finalIndex - 1 + symbolsCount) % symbolsCount;
        const randomOffset = randInt(10) * symbolHeight;
        const distance =  (symbolsCount * symbolHeight) + randomOffset + (topIndex * symbolHeight); 
        // symbolsCount * symbolHeight = 40 * 100 = 4000 => 1 loop

        reelInner.style.transition = `transform ${durationSec}s linear`;
        reelInner.style.transform  = `translateY(-${distance}px)`;
      }

      function evaluateMiddleRow(finalIndices, bet) {
        const midSymbols = finalIndices.map(idx => iconSet[idx]);
        const firstSym = midSymbols[0];
        let matches = 1;
        for (let i=1; i<4; i++) {
          if (midSymbols[i] === firstSym) matches++;
        }
        let winnings = 0;
        if (firstSym === "ðŸ†" && matches === 4) {
          winnings = bet * 10; // jackpot
        } else if (matches === 4) {
          winnings = bet * 5;
        } else if (matches === 3) {
          winnings = bet * 3;
        } else if (matches === 2) {
          winnings = bet * 2;
        }
        return {winnings, matches, midSymbols};
      }

      function handleWinLine(matches) {
        winLine.style.display = (matches >= 2) ? "block" : "none";
      }

      function spinAllReels() {
        if (isSpinning) return;

        let bet = getSelectedBet();
        if (!bet) {
          messageEl.textContent = "Please select a bet first!";
          return;
        }

        const isFreeSpin = (freeSpins > 0);
        if (!isFreeSpin && !cheatUnlimitedFunds.checked) {
          if (balanceCents < bet) {
            messageEl.textContent = "Not enough balance!";
            return;
          }
        }

        // Deduct bet unless free spin or unlimited
        if (!isFreeSpin && !cheatUnlimitedFunds.checked) {
          balanceCents -= bet;
        }
        updateBalanceDisplay();
        messageEl.textContent = "";
        bonusMessage.textContent = "";
        handleWinLine(0);

        isSpinning = true;

        // Play spin sound
        spinSound.currentTime = 0;
        spinSound.play().catch(err => console.log("Spin sound blocked:", err));

        // Decide final indices
        const finalIndices = [0,0,0,0];
        if (cheatAlwaysJackpot.checked) {
          finalIndices[0] = 0; finalIndices[1] = 0; finalIndices[2] = 0; finalIndices[3] = 0;
        } else if (cheatAlwaysWinMoney.checked) {
          const r = randInt(symbolsCount);
          finalIndices[0] = r;
          finalIndices[1] = r;
          finalIndices[2] = randInt(symbolsCount);
          finalIndices[3] = randInt(symbolsCount);
        } else {
          for (let i=0; i<4; i++) {
            finalIndices[i] = randInt(symbolsCount);
          }
        }

        // Spin reels, each stops left->right after 1s,2s,3s,4s
        spinOneReel(reel1Inner, finalIndices[0], 1);
        spinOneReel(reel2Inner, finalIndices[1], 2);
        spinOneReel(reel3Inner, finalIndices[2], 3);
        spinOneReel(reel4Inner, finalIndices[3], 4);

        // Evaluate after 4s
        setTimeout(() => {
          const {winnings, matches, midSymbols} = evaluateMiddleRow(finalIndices, bet);
          balanceCents += winnings;
          updateBalanceDisplay();

          if (winnings > 0) {
            // Play win sound
            winSound.currentTime = 0;
            winSound.play().catch(err => console.log("Win sound blocked:", err));

            let msg = "";
            if (matches === 2) {
              msg = "2-of-a-kind!";
            } else if (matches === 3) {
              msg = "3-of-a-kind!";
            } else if (matches === 4 && midSymbols[0] === "ðŸ†") {
              msg = "EGGPLANT JACKPOT!";
            } else if (matches === 4) {
              msg = "4-of-a-kind!";
            }
            messageEl.textContent = `${msg} Middle row: ${midSymbols.join(" ")}. You won $${(winnings/100).toFixed(2)}!`;
          } else {
            messageEl.textContent = `No match. Middle row: ${midSymbols.join(" ")}. Better luck next time!`;
          }
          handleWinLine(matches);

          // Free spins if 3-of-a-kind or better
          if (matches >= 3 && winnings > 0) {
            freeSpins++;
            bonusMessage.textContent = `You earned +1 FREE SPIN! (Now ${freeSpins} total)`;
          } else if (isFreeSpin) {
            freeSpins--;
            bonusMessage.textContent = `Used 1 FREE SPIN. ${freeSpins} left.`;
          }

          // Possibly minigame
          let launchMini = (Math.random() < MINIGAME_CHANCE);
          if (cheatAlwaysMinigame.checked) launchMini = true;
          if (launchMini) {
            showRandomMinigame(bet);
          }

          isSpinning = false;
        }, 4000);
      }
      spinBtn.addEventListener("click", spinAllReels);

      /********************************************
       *         MULTI-MINIGAME OVERLAY          *
       ********************************************/
      const minigameOverlay = document.getElementById("minigameOverlay");

      function showRandomMinigame(bet) {
        const pick = randInt(3);
        if (pick === 0) showCardsMinigame(bet);
        else if (pick === 1) showTicMinigame(bet);
        else showHangmanMinigame(bet);
      }
      function openOverlay(whichId) {
        document.getElementById("cardsGame").style.display     = "none";
        document.getElementById("ticTacToeGame").style.display = "none";
        document.getElementById("hangmanGame").style.display   = "none";
        document.getElementById(whichId).style.display = "block";
        minigameOverlay.style.display = "flex";
      }
      function closeOverlay() {
        minigameOverlay.style.display = "none";
      }

      /****************** CARDS GAME ********************/
      const cardsGame      = document.getElementById("cardsGame");
      const cardsContainer = document.getElementById("cardsContainer");
      const cardsMessage   = document.getElementById("cardsMessage");
      const cardsQuitBtn   = document.getElementById("cardsQuitBtn");

      let cardsPicks   = 0;
      let cardsValues  = [];
      let cardsBet     = 0;

      function showCardsMinigame(bet) {
        cardsBet    = bet;
        cardsPicks  = 0;
        cardsValues = new Array(6).fill(0).map(() => randInt(10)+1);
        cardsMessage.textContent = "";
        cardsContainer.innerHTML = "";

        for (let i=0; i<6; i++) {
          const div = document.createElement("div");
          div.className = "card";
          div.textContent = "?";
          div.onclick = () => pickOneCard(i, div);
          cardsContainer.appendChild(div);
        }
        openOverlay("cardsGame");
      }
      function pickOneCard(i, cardDiv) {
        if (cardDiv.classList.contains("flipped")) return;
        cardDiv.textContent = cardsValues[i];
        cardDiv.classList.add("flipped");
        cardsPicks++;
        if (cardsPicks === 3) finishCardsGame();
      }
      function finishCardsGame() {
        let sum = 0;
        const flipped = document.querySelectorAll("#cardsContainer .card.flipped");
        flipped.forEach(c => sum += parseInt(c.textContent,10) || 0);
        const bonus = sum*10;
        balanceCents += bonus;
        updateBalanceDisplay();
        cardsMessage.textContent = `You found ${sum}! Bonus: $${(bonus/100).toFixed(2)}.`;
        setTimeout(() => closeOverlay(), 1500);
      }
      cardsQuitBtn.onclick = () => closeOverlay();

      /****************** TIC-TAC-TOE *******************/
      const ticTacToeGame = document.getElementById("ticTacToeGame");
      const ticGrid       = document.getElementById("ticGrid");
      const ticMessage    = document.getElementById("ticMessage");
      const ticQuitBtn    = document.getElementById("ticQuitBtn");

      let ticBet = 0;
      let ticBoard = [];
      let currentPlayer = "X";
      let ticActive = false;

      function showTicMinigame(bet) {
        ticBet = bet;
        ticBoard = new Array(9).fill("");
        currentPlayer = "X";
        ticActive = true;
        ticMessage.textContent = "You are X. Take your turn!";
        ticGrid.innerHTML = "";
        for (let i=0; i<9; i++) {
          const cell = document.createElement("div");
          cell.className = "tic-cell";
          cell.onclick = () => ticClickCell(i, cell);
          ticGrid.appendChild(cell);
        }
        openOverlay("ticTacToeGame");
      }
      function ticClickCell(index, cellDiv) {
        if (!ticActive) return;
        if (ticBoard[index] !== "") return;
        ticBoard[index] = "X";
        cellDiv.textContent = "X";
        cellDiv.classList.add("X","disabled");

        let result = checkTicWin(ticBoard);
        if (result) { endTicGame(result); return; }
        if (ticBoard.every(c=>c!=="")) { endTicGame("tie"); return; }

        ticMessage.textContent = "AI's turn...";
        ticActive = false;
        setTimeout(() => aiMove(), 700);
      }
      function aiMove() {
        const emptyIndices = ticBoard.map((v,i)=>[v,i]).filter(x=>x[0]==="").map(x=>x[1]);
        if (emptyIndices.length === 0) {
          endTicGame("tie");
          return;
        }
        const pick = emptyIndices[randInt(emptyIndices.length)];
        ticBoard[pick] = "O";
        const cell = ticGrid.children[pick];
        cell.textContent = "O";
        cell.classList.add("O","disabled");

        let result = checkTicWin(ticBoard);
        if (result) { endTicGame(result); return; }
        if (ticBoard.every(c=>c!=="")) { endTicGame("tie"); return; }

        ticActive = true;
        ticMessage.textContent = "Your turn!";
      }
      function checkTicWin(bd) {
        const combos = [
          [0,1,2],[3,4,5],[6,7,8],
          [0,3,6],[1,4,7],[2,5,8],
          [0,4,8],[2,4,6]
        ];
        for (let c of combos) {
          if (bd[c[0]]!=="" && bd[c[0]]===bd[c[1]] && bd[c[1]]===bd[c[2]]) {
            return bd[c[0]]; // "X" or "O"
          }
        }
        return null;
      }
      function endTicGame(result) {
        ticActive = false;
        if (result === "X") {
          balanceCents += ticBet*2;
          updateBalanceDisplay();
          ticMessage.textContent = `You WIN! +$${(ticBet*2/100).toFixed(2)}.`;
        } else if (result === "O") {
          ticMessage.textContent = "AI Wins. No bonus!";
        } else {
          // tie => get bet back
          balanceCents += ticBet;
          updateBalanceDisplay();
          ticMessage.textContent = `Tie! Bet returned. +$${(ticBet/100).toFixed(2)}.`;
        }
        setTimeout(()=>closeOverlay(), 2000);
      }
      ticQuitBtn.onclick = () => closeOverlay();

      /****************** HANGMAN *******************/
      const hangmanGame     = document.getElementById("hangmanGame");
      const hangmanFigure   = document.getElementById("hangmanFigure");
      const hangmanWord     = document.getElementById("hangmanWord");
      const hangmanAlphabet = document.getElementById("hangmanAlphabet");
      const hangmanStatus   = document.getElementById("hangmanStatus");
      const hangmanQuitBtn  = document.getElementById("hangmanQuitBtn");

      const hangmanWords = ["SLOT","EGGPLANT","JACKPOT","HANGMAN","BONUS","WALRUS","BALLOON","WINDOW"];
      let hangmanBet    = 0;
      let hangmanSecret = "";
      let hangmanGuessed= [];
      let hangmanWrong  = 0;
      let hangmanActive = false;

      function showHangmanMinigame(bet) {
        hangmanBet    = bet;
        hangmanSecret = hangmanWords[randInt(hangmanWords.length)].toUpperCase();
        hangmanGuessed= [];
        hangmanWrong  = 0;
        hangmanActive = true;
        updateHangmanDisplay();
        openOverlay("hangmanGame");
      }
      function updateHangmanDisplay() {
        hangmanFigure.textContent = `Attempts left: ${6 - hangmanWrong}`;
        let display = "";
        for (let c of hangmanSecret) {
          if (hangmanGuessed.includes(c)) display += c+" ";
          else display += "_ ";
        }
        hangmanWord.textContent = display.trim();

        if (!display.includes("_")) {
          // user won => 2Ã— bet
          hangmanActive = false;
          balanceCents += hangmanBet*2;
          updateBalanceDisplay();
          hangmanStatus.textContent = `You WON! +$${(hangmanBet*2/100).toFixed(2)}.`;
          setTimeout(()=>closeOverlay(),2000);
          return;
        }
        if (hangmanWrong >=6) {
          // lost
          hangmanActive = false;
          hangmanStatus.textContent = `You Lost! The word was ${hangmanSecret}.`;
          setTimeout(()=>closeOverlay(),2000);
          return;
        }

        // build alphabet
        hangmanAlphabet.innerHTML = "";
        const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
        for (let letter of letters) {
          const btn = document.createElement("button");
          btn.textContent = letter;
          if (hangmanGuessed.includes(letter)||hangmanWrong>=6||!hangmanActive) {
            btn.disabled = true;
            btn.classList.add("used");
          }
          btn.onclick = ()=>guessHangmanLetter(letter,btn);
          hangmanAlphabet.appendChild(btn);
        }
      }
      function guessHangmanLetter(letter, btn) {
        if (!hangmanActive) return;
        btn.disabled = true;
        btn.classList.add("used");
        if (hangmanSecret.includes(letter)) {
          hangmanGuessed.push(letter);
        } else {
          hangmanWrong++;
        }
        updateHangmanDisplay();
      }
      hangmanQuitBtn.onclick = ()=>closeOverlay();

    </script>
  </div>
</body>
</html>
